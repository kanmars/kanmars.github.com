<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>[KANMARS原创] - Linux Quota简介 | KANMARS的博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">[KANMARS原创] - Linux Quota简介</h1><a id="logo" href="/.">KANMARS的博客</a><p class="description">helloword 2046。趁着，我会喜怒你会哀乐，唱几分钟情歌。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 홈</i></a><a href="/archives/"><i class="fa fa-archive"> 아카이브</i></a><a href="/2016/04/23/2016-04-23-mysongs/"><i class="fa fa-user"> 소개</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">[KANMARS原创] - Linux Quota简介</h1><div class="post-meta">Nov 19, 2014</div><a data-thread-key="2014/11/19/2014-11-19-LinuxBaseQuota/" href="/2014/11/19/2014-11-19-LinuxBaseQuota/#comments" class="ds-thread-count"></a><div class="post-content"><p></p><p>          linux  (centos) quota配置  在网络管理的工作中，由于硬盘的资源是有限的，常常需要为多用户的服务器设定用户的linux磁盘配额。这个功能对公用的多用户服务器（免费的或者收费的）来说，更是非常必要的。Quota就是在RedHatlinux下实现linux磁盘配额的工具。  quota只支持单独的挂载文件系统  不是某一个目录。 </p><p></p>
<p></p><p> </p><p></p>
<p></p><p><strong>1. 挂载目录加入 quota </strong> <br><br></p><p></p>
<p><table border="0" width="653"><br>  <tbody><br>    <tr><br>      <td bgcolor="#000000"><p><br><br>              <span class="STYLE1"><strong>查看/home目录挂载情况 </strong> <br><br>        [root@bogon ~]# <strong>df -h /home </strong> <br><br>        Filesystem            Size  Used Avail Use% Mounted on<br><br>        /dev/sda3             2.0G   35M  1.8G   2% /home<br><br>        <br><br>        [root@bogon ~]# <strong>mount | grep home </strong> <br><br>        /dev/sda3 on /home type ext4 (rw)<br><br>        <br><br>        <strong>使用者与群组的 quota 文件系统支持参数：usrquota, grpquota </strong> <br><br>        [root@bogon ~]# <strong>mount -o remount,usrquota,grpquota /home </strong> <br><br>        <br><br>        <strong>查看 </strong> <strong> 确定加了  usrquota,grpquota </strong> <br><br>        [root@bogon ~]# <strong>mount | grep home</strong> <br><br>        /dev/sda3 on /home type ext4 (rw,usrquota,grpquota)<br><br>        <br><br>        <strong>编辑 fstab文件让系统启动时挂载quota</strong> <br><br>        [root@bogon ~]# <strong>vi /etc/fstab    </strong> <strong> 重启后生效</strong> <br><br>        LABEL=/home   /home  ext4   defaults,usrquota,grpquota  1 2 </span></p><br>          <p class="STYLE1"><strong>重新挂载<br><br>            </strong> [root@bogon ~]# <strong>umount /home<br><br>            </strong> [root@bogon ~]# <strong>mount -a<br><br>        </strong> [root@bogon ~]# <strong>mount | grep home </strong> </p></td><br>    </tr><br>  </tbody><br></table></p>
<p></p><p><br><br>    <br><br>  <strong>2. quota安装  </strong> <strong> 生成usrquota, grpquota两个目录 </strong> <br><br></p><p></p>
<p><table border="0" width="653"><br>  <tbody><br>    <tr><br>      <td bgcolor="#000000"><p><span class="STYLE1"><strong>对整个系统含有 usrquota, grpquota 参数的文件系统进行 quotacheck 扫瞄 </strong> <br><br>        [root@bogon ~]# <strong>quotacheck -avug </strong> <br><br>        <br><br>        -bash: command not found<br><br>        <br><br>        [root@bogon ~]# <strong>yum install quota 安装quota </strong> <br><br>        <br><br>        [root@bogon ~]# <strong>quotacheck -avug</strong> <br><br>        <strong>自动创建 usrquota, grpquota两个目录 </strong> <br><br>        [root@bogon ~]# <strong>ll -d /home/ </strong> <br><br>        -rw——- 1 root root 8192 Mar  6 11:58 /home/aquota.group<br><br>        -rw——- 1 root root 9216 Mar  6 11:58 /home/aquota.user<br><br>      </span></p><br>          <p class="STYLE1"> </p><br>        <p class="STYLE1"><strong>这时， 由于某种需要，或者在某种情况，“不得不”运行这个命令  ： </strong> </p><br>        <p class="STYLE1">[root@bogon ~]# <strong>quotacheck -avug -mf </strong> </p><br>        <p class="STYLE1"><strong>参数 -m[M] 意思是：强迫在“读、写”模式下检查硬盘的 quota  （有一定的“正在写”的数据丢失可能，应确保没有进程在写这个分区。建议在单用户模式下进行。）。 </strong> </p><br>        <p class="STYLE1"><br><br>          [root@bogon ~]# <strong>quotaon -auvg   </strong> <strong>启动 quota </strong> <br><br>          /dev/sda3 [/home]: group quotas turned on<br><br>      /dev/sda3 [/home]: user quotas turned on </p></td><br>    </tr><br>  </tbody><br></table></p>
<p></p><p><br><br>    <br><br>  <strong>3. quota限制大小设置 </strong> <br><br></p><p></p>
<p><table width="653" border="0" bordercolor="#000000" bgcolor="#000000"><br>  <tbody><br>    <tr><br>      <td bgcolor="#000000"><p><span class="STYLE1"><strong>myquota1账号加入quota 限制使用 在这里固定每个用户使用的磁盘大小为500M </strong> <br><br>        [root@bogon ~]# <strong>useradd myquota1</strong> <br><br>        [root@bogon ~]# <strong>edquota -u myquota1</strong> <br><br>        Filesystem    blocks    soft    hard  inodes  soft  hard<br><br>        /dev/sda3         80  500000  600000      10     0     0<br><br>        <br><br>        <strong>复制myquota1用户的信息给 myquota2 </strong> <br><br>        [root@bogon ~]# <strong>edquota -p myquota1 -u myquota2</strong> <br><br>        <br><br>        [root@bogon ~]# <strong>edquota -g myquotagrp </strong> <strong>编辑myquotagrp组的总共使用大小 </strong> <br><br>        Filesystem    blocks    soft     hard  inodes  soft  hard<br><br>        /dev/sda3        160  10000000  12000000       20     0     0<br><br>        <br><br>      </span></p><br>          <p><span class="STYLE1">[root@bogon ~]# <strong>edquota -t   </strong> <strong>修改宽限时间  当使用者文件超过大小时 </strong> <br><br>          <br><br>          [root@bogon ~]# <strong>quota -uvs myquota1 myquota2 </strong> <strong>查询使用情况 </strong> <br><br>          Filesystem  blocks   quota   limit   grace   files   quota   limit   grace<br><br>          /dev/sda3      80    495M    595M              10       0       0<br><br>          Disk quotas for user myquota2 (uid 501):<br><br>          Filesystem  blocks   quota   limit   grace   files   quota   limit   grace<br><br>          /dev/sda3      80    495M    595M              10       0       0<br><br>          <br><br>          [root@bogon ~]# <strong>quota -gvs myquotagrp  </strong> <strong>查询myquotagrp组使用情况 </strong> <br><br>          <br><br>          edquota -g myquotagrp<br><br>          Filesystem    blocks    soft     hard  inodes  soft  hard<br><br>          /dev/sda3        160   1000M     1200M      20     0     0<br><br>          <br><br>          [root@bogon ~]# <strong>repquota -auvs </strong> <strong>查询所有用户使用情况 </strong> <br><br>          <br><br>          User            used    soft    hard  grace    used  soft  hard  grace<br><br>          ———————————————————————-<br><br>          root      –      20       0       0              2     0     0<br><br>          myquota1  –      32       495M    595M           10     0     0<br><br>          myquota2  –      32       495M    595M           10     0     0<br><br>          myquotagrp –      64      1000M   1200M          20     0     0<br><br>          <br><br>          Statistics:<br><br>          Total blocks: 7<br><br>          Data blocks: 1<br><br>          Entries: 4<br><br>          Used average: 4.000000</span><br><br>        </p></td><br>    </tr><br>  </tbody><br></table></p>
<p></p><p><br><br>    <br><br>  <strong>4. quota </strong> <strong>测试 </strong> <br><br></p><p></p>
<p><table width="653" border="0" bordercolor="#000000" bgcolor="#000000"><br>  <tbody><br>    <tr><br>      <td bgcolor="#000000"><p><span class="STYLE1"><strong>利用 myquota1 的身份，建置一个 550MB 的大文件，并观察 quota 结果！ </strong> <br><br>        [root@bogon ~]# <strong>dd if=/dev/zero of=bigfile bs=1M count=550 </strong> <br><br>        [root@bogon ~]# <strong>repquota -auv </strong> <br><br>        Block limits                File limits<br><br>        User            used    soft    hard  grace    used  soft  hard  grace<br><br>        ———————————————————————-<br><br>        myquota1  +-  556840  500000  600000 13days      11     0     0<br><br>        <br><br>        <strong>你可以发现 myquota1 的 grace 出现！ </strong> <br><br>        <strong><br><br>          再创建另外一个大文件，让总容量超过 600M ！ </strong> <br><br>        [root@bogon ~]# <strong>dd if=/dev/zero of=bigfile2 bs=1M count=600</strong> <br><br>        du -sk<br><br>        600000  .  <strong>文件大小已经查过了设置的大小  操作失败 </strong> <br><br>        <br><br>        [root@bogon ~]# <strong>warnquota  </strong> <strong>查看是否有警告信息 </strong> </span></p><br>          <p class="STYLE1"> </p><br>        <p class="STYLE1"> </p><br>        <p class="STYLE1"><strong>您如果要取消磁盘空间的限制,可用以下命令，请看:</strong> <br><br>          [root@bogon ~]# <strong> quotaoff /home </strong> <strong>（取消磁盘空间限制。） </strong> <br><br>      [root@bogon ~]# <strong>quotaon /home </strong> <strong>（现在启动磁盘空间限制。） </strong> </p></td><br>    </tr><br>  </tbody><br></table></p>
<p></p><p>&nbsp;</p><p></p>
<blockquote>&nbsp;</blockquote>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://kanmars.github.io/2014/11/19/2014-11-19-LinuxBaseQuota/" data-id="ciwjetze8000048vq6k6njz2f" class="article-share-link">공유하기</a><div class="tags"><a href="/tags/it/">it</a><a href="/tags/server/">server</a><a href="/tags/architecture/">architecture</a></div><div class="post-nav"><a href="/2014/11/22/2014-11-23-LinuxCPUINFO/" class="pre">[KANMARS原创] - Linux下的CPU信息</a></div><div data-thread-key="2014/11/19/2014-11-19-LinuxBaseQuota/" data-title="[KANMARS原创] - Linux Quota简介" data-url="https://kanmars.github.io/2014/11/19/2014-11-19-LinuxBaseQuota/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2014/11/19/2014-11-19-LinuxBaseQuota/" data-title="[KANMARS原创] - Linux Quota简介" data-url="https://kanmars.github.io/2014/11/19/2014-11-19-LinuxBaseQuota/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://kanmars.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 카테고리</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 태그</i></div><div class="tagcloud"><a href="/tags/jetty/" style="font-size: 15px;">jetty</a> <a href="/tags/it/" style="font-size: 15px;">it</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/itlife/" style="font-size: 15px;">itlife</a> <a href="/tags/rsa/" style="font-size: 15px;">rsa</a> <a href="/tags/tb/" style="font-size: 15px;">tb</a> <a href="/tags/drawline/" style="font-size: 15px;">drawline</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/strategy/" style="font-size: 15px;">strategy</a> <a href="/tags/tblife/" style="font-size: 15px;">tblife</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/server/" style="font-size: 15px;">server</a> <a href="/tags/c/" style="font-size: 15px;">c</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/lua/" style="font-size: 15px;">lua</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/neuralnetwork/" style="font-size: 15px;">neuralnetwork</a> <a href="/tags/cpu/" style="font-size: 15px;">cpu</a> <a href="/tags/disk/" style="font-size: 15px;">disk</a> <a href="/tags/fidsk/" style="font-size: 15px;">fidsk</a> <a href="/tags/fstab/" style="font-size: 15px;">fstab</a> <a href="/tags/lvm/" style="font-size: 15px;">lvm</a> <a href="/tags/aix/" style="font-size: 15px;">aix</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 과거</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/07/29/2017-07-29-half-year/">[KANMARS原创]-最近半年我的毁灭性经历</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/06/2017-01-06-springcloud_use_002_ssc_configserver/">[KANMARS原创]-SpringCloud-实用篇(2)-configserver</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/2016-12-11-springcloud_use_001_whatissc/">[KANMARS原创]-SpringCloud-实用篇(1)-什么是springCLoud</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/18/2016-11-18-springmvc_source_004_viewresolver/">[KANMARS原创]-SpringMVC源码解析(4) - 视图处理器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/18/2016-11-18-springmvc_source_003_requestprocess/">[KANMARS原创]-SpringMVC源码解析(3) - 请求处理过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/17/2016-11-17-springmvc_source_002_start/">[KANMARS原创]-SpringMVC源码解析(2) - 启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/17/2016-11-17-springmvc_source_001_introduce/">[KANMARS原创]-SpringMVC源码解析(1) - 简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/04/2016-11-04-SomeThingAndNothing/">SomeThingAndNothing</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/25/2016-10-25-news-LongRoad/">news It's a Long Road</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/19/2016-10-19-Scale-Services/">On Designing and Deploying Internet-Scale Services</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 최근 댓글</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 블로그롤</i></div><ul></ul><a href="http://www.linux.cn" title="Linux-CN" target="_blank">Linux-CN</a><ul></ul><a href="http://www.gome.com.cn" title="国美互联网" target="_blank">国美互联网</a><ul></ul><a href="http://jr.gome.com.cn" title="国美金融" target="_blank">国美金融</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">KANMARS的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'kanmars'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>